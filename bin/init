#!/bin/sh

BASEDIR=$(dirname "$0")

echo "#### Starting terraform init ####"
echo "### Region: $AWS_DEFAULT_REGION ###"
echo "### Options: $* ###"

set +e
OUTPUT=$(sh -c "terraform init -input=false -no-color $*" 2>&1)
SUCCESS=$?
echo "$OUTPUT"
set -e

if [ "$SUCCESS" -ne 0 ]; then
  echo "#### Terraform Init failed ####"

  # Create deployment failure status
  "${BASEDIR}"/deployment_create_status failure

  exit "$SUCCESS"
fi

echo "#### Terraform Init succeded ####"

exit 0
